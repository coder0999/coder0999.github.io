import{r as l,c as h,d as p,q as f,o as j,w as v,a as b,u as N,h as w,v as y,j as e}from"./index-CXLLT8_k.js";const k=o=>{const[a,s]=l.useState([]),[c,r]=l.useState(!0),[n,d]=l.useState(null);return l.useEffect(()=>{if(!o){r(!1),s([]);return}const u=h(p,"orders"),x=f(u,v("userId","==",o),j("createdAt","desc")),m=b(x,i=>{const t=i.docs.map(g=>({id:g.id,...g.data()}));s(t),r(!1)},i=>{console.error("Error fetching real-time orders:",i),d(i),r(!1)});return()=>m()},[o]),{orders:a,loading:c,error:n}},C=({onFilterChange:o})=>{const[a,s]=l.useState(!1),c=l.useRef(null);l.useEffect(()=>{const n=d=>{c.current&&!c.current.contains(d.target)&&s(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[c]);const r=n=>{o(n),s(!1)};return e.jsxs("div",{className:"relative",ref:c,children:[e.jsx("button",{onClick:()=>s(!a),className:"p-2 rounded-full hover:bg-gray-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01"})})}),a&&e.jsxs("div",{className:"absolute left-0 mt-2 w-48 bg-white rounded-md shadow-xl z-20",children:[e.jsx("button",{onClick:()=>r("all"),className:"block w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"الكل"}),e.jsx("button",{onClick:()=>r("pending"),className:"block w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"قيد المراجعة"}),e.jsx("button",{onClick:()=>r("completed"),className:"block w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"مكتمل"}),e.jsx("button",{onClick:()=>r("rejected"),className:"block w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"مرفوض"})]})]})},E=o=>{const a={completed:{text:"مكتمل",className:"bg-green-200 text-green-800"},rejected:{text:"مرفوض",className:"bg-red-200 text-red-800"},pending:{text:"قيد المراجعة",className:"bg-yellow-200 text-yellow-800"}},s=a[o]||a.pending;return e.jsx("span",{className:`px-2 py-1 text-sm rounded-full ${s.className}`,children:s.text})},M=()=>{const{user:o}=N(),a=w(),{orders:s,loading:c,error:r}=k(o?.uid),[n,d]=l.useState("all"),{setTitle:u,setLeftContent:x,setRightContent:m}=y();l.useEffect(()=>{const t=()=>e.jsx("button",{onClick:()=>a(-1),className:"p-2 rounded-full hover:bg-gray-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})});return u("طلبات الشراء"),x(e.jsx(t,{})),m(e.jsx(C,{onFilterChange:d})),()=>{u(""),x(null),m(null)}},[u,x,m,a]);const i=l.useMemo(()=>n==="all"?s:n==="pending"?s.filter(t=>!t.status||t.status==="pending"):s.filter(t=>t.status===n),[s,n]);return c?e.jsx("div",{className:"p-4 text-center",children:"Loading..."}):r?e.jsxs("div",{className:"p-4 text-center text-red-500",children:["Error: ",r.message]}):e.jsx("div",{dir:"rtl",children:i.length===0?e.jsx("p",{className:"text-right text-gray-500 mt-4",children:"لا توجد طلبات شراء لهذه الحالة."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(t=>e.jsxs("div",{className:"bg-white border rounded-lg shadow-md p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold",children:t.productName}),E(t.status)]}),e.jsxs("p",{className:"text-gray-600",children:[t.productPrice," نقطة"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["رقم الطلب: ",e.jsx("span",{className:"font-mono",children:t.id})]})]}),e.jsxs("div",{className:"border-t mt-4 pt-4",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"معلومات التواصل:"})," ",t.contactMethod," - ",t.phoneNumber]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["تاريخ الطلب: ",t.createdAt?.toDate?t.createdAt.toDate().toLocaleDateString("ar-EG"):"غير محدد"]})]})]},t.id))})})};export{M as default};
