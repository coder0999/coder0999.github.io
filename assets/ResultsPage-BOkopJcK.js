import{p as E,h as k,u as $,r as y,f as N,d as v,k as A,j as e,t as D}from"./index-DmBEyatp.js";const R=()=>{const P=E(),C=k(),{user:l}=$(),{userAnswers:x,exam:o}=P.state||{},{correctAnswersCount:h,earnedPoints:m,totalQuestions:f,percentage:b}=y.useMemo(()=>{if(!o)return{correctAnswersCount:0,earnedPoints:0,totalQuestions:0,percentage:0};let s=0,t=0;const c=o.questions.length;o.questions.forEach((r,g)=>{const u=x[g],a=r.correctAnswer;r.options.findIndex(d=>(typeof d=="string"?d:d.text)===u)===a&&(s++,t+=r.points||1)});const n=c>0?Math.round(s/c*100):0;return{correctAnswersCount:s,earnedPoints:t,totalQuestions:c,percentage:n}},[o,x]);return y.useEffect(()=>{if(l&&o){const s=N(v,"exam_results",o.id,"submissions",l.uid),t={email:l.email,userId:l.uid,percentage:b,correctAnswers:h,totalQuestions:f,earnedPoints:m,userAnswers:x,submittedAt:new Date};A(s,t,{merge:!0}).then(()=>console.log("Exam results saved successfully!")).catch(n=>console.error("Error saving exam results: ",n));const c=async()=>{const n=N(v,"users",l.uid);try{const u=((await D(n)).data()?.points||0)+m;await A(n,{points:u},{merge:!0}),console.log("User points updated successfully!")}catch(r){console.error("Error updating user points: ",r)}};m>0&&c()}},[l,o,b,h,f,m,x]),o?e.jsxs("div",{className:"py-4 flex-grow",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center mb-6",children:"نتائج الامتحان"}),!l&&e.jsxs("div",{className:"bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4 mb-6",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"ملاحظة:"}),e.jsx("p",{children:"لن يتم احتساب النقاط الا عند تسجيل الدخول من صفحة البروفايل."})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-8",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg flex flex-col justify-center items-center border-t-4 border-indigo-500",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 mb-2",children:"النتيجة"}),e.jsxs("div",{className:"flex flex-col items-center justify-center text-3xl font-bold text-indigo-600",children:[e.jsx("span",{children:h}),e.jsx("hr",{className:"w-8 border-t-2 border-indigo-400 my-0.5"}),e.jsx("span",{children:f})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg flex flex-col justify-center items-center border-t-4 border-green-500",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 mb-2",children:"النسبة المئوية"}),e.jsxs("p",{className:"text-5xl font-bold text-green-600",children:[b,e.jsx("span",{className:"text-2xl",children:"%"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg flex flex-col justify-center items-center border-t-4 border-yellow-500",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 mb-2",children:"النقاط المكتسبة"}),e.jsx("p",{className:"text-5xl font-bold text-yellow-500",children:m})]})]}),o.questions.map((s,t)=>{const c=x[t],n=s.correctAnswer,r=s.options.findIndex(a=>(typeof a=="string"?a:a.text)===c),g=r===n,u=s.points||1;return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md relative w-full",children:[e.jsx("div",{className:"question-number-box",children:e.jsx("span",{children:t+1})}),e.jsx("div",{className:"result-points-box",children:e.jsxs("span",{className:g?"text-black":"text-gray-500 line-through",children:[u," نقطة"]})}),e.jsx("p",{className:"text-lg md:text-xl text-gray-800 mb-4 break-words pt-16",children:s.text}),e.jsx("div",{className:"space-y-3",children:s.options.map((a,i)=>{const d=typeof a=="string"?a:a.text;let p="flex justify-between items-center p-2 rounded-lg",j="text-gray-700 text-base md:text-lg",w="";return i===n&&(p+=" bg-green-100",j="text-green-800 text-base md:text-lg font-bold",w='<i class="fas fa-check-circle text-green-600 ml-2"></i>'),r===i&&r!==n&&(p+=" bg-red-100",j="text-red-800 text-base md:text-lg font-bold",w='<i class="fas fa-times-circle text-red-600 ml-2"></i>'),e.jsxs("div",{className:p,children:[e.jsxs("div",{className:"custom-radio",children:[e.jsx("input",{type:"radio",id:`result-option-${t}-${i}`,name:`result-question-${t}`,value:d,className:"form-radio",checked:r===i,disabled:!0}),e.jsx("label",{htmlFor:`result-option-${t}-${i}`,className:j,children:d})]}),e.jsx("span",{dangerouslySetInnerHTML:{__html:w}})]},i)})})]},t)})]}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx("button",{onClick:()=>C("/"),className:"bg-gray-400 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform",children:"العودة إلى الامتحانات"})})]}):e.jsx("div",{children:"No results to display."})};export{R as default};
